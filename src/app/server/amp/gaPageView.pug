- var singleQuoteRE = /'/g;
- var pageName = headerMetaData.pageName.replace(singleQuoteRE, '\\\'');
- var authorProfiles = entity.authorProfiles ? entity.authorProfiles : [];
- var authorNames = authorProfiles.map(function(profile) { return profile.name });
- var authorName = authorNames.join(', ').replace(singleQuoteRE, '\\\'');
- var tags = entity.tags ? entity.tags : [];
- tags = JSON.stringify(tags);
- var breadcrumbs = headerMetaData.breadcrumbs ? headerMetaData.breadcrumbs : [];
- var breadcrumbNames = [];
- breadcrumbs.map(function(breadcrumb) { breadcrumbs.push(breadcrumb.name) });
- breadcrumbNames = JSON.stringify(breadcrumbNames);

amp-analytics(type="googleanalytics")
    script(type="application/json").
        {
            "vars": {
                "account": "#{locals.config.ga.id}"
            },
            "triggers": {
                "trackPageview": {
                    "on": "visible",
                    "request": "pageview",
                    "vars": {
                        "pageInstanceID": "#{headerMetaData.googleTagManagerMasthead}:#{section.id}:#{headerMetaData.googleTagManagerEnvironment}",
                        "page": {
                            "pageInfo": {
                                "pageId": "#{entity.id}",
                                "pageName": "#{pageName}",
                                "issueDate": "#{entity.dateCreated}",
                                "sysEnv": "#{headerMetaData.googleTagManagerEnvironment}",
                                "dateCreated": "#{entity.dateCreated}",
                                "author": "#{authorName}",
                                "breadCrumbs": #{breadcrumbNames}
                            },
                            "category": {
                                "groupingCategory": "#{headerMetaData.GroupingCategory}",
                                "pageType": "#{entity.nodeType}",
                                "masthead": "#{headerMetaData.googleTagManagerMasthead}",
                                "tags": #{tags}
                            }
                        }
                    }
                }
            }
        }

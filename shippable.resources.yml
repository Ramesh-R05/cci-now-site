resources:

#
# Common setup that should be moved into a common shippable repo
#
  - name: slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"

# Docker Image for the now-site
  - name: now-site-img-master
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/now-site"
    seed:
      versionName: latest

# Docker Image for the now-site
  - name: now-site-img-branch
    type: image
    integration: AWS-digital-services-ECR
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/now-site"
    seed:
      versionName: latest

# Github repo
  - name: now-site-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/now-site
      branch: master

# Release version
  - name: now-site-version
    type: version
    seed:
      versionName: "1.0.0"

#
# DEV environment configuration
#
  - name: env-dev-ecs
    type: cluster
    integration: AWS-digital-nonprod
    pointer:
      sourceName : "dev_app_ecs"
      region: "ap-southeast-2"

  - name: nz-now-site-alb-dev
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/dev-site-now-nz/adf823f09676e63c"
      method: application

  - name: now-site-alb-dev
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/dev-site-now-au/440e2f8716fd2a53"
      method: application

  - name: now-site-alb-dev-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/dev-site-branch-now-au/317a47999c72692f"
      method: application

  - name: now-site-alb-stubbed
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/stubbed-site-now-au/7b1ac13d3e8afd78"
      method: application

# TO BE UPDATED
  - name: now-site-params-dev
    type: params
    version:
      params:
        NODE_ENV: "dev"  #change this to dev when we are ready

  - name: now-site-params-nz-region
    type: params
    version:
      params:
        NODE_REGION: "nz"

  - name: now-site-params-stubbed
    type: params
    version:
      params:
        NODE_ENV: "stubbed"

# Docker Image Options
  - name: now-site-opts-dev
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 64
      portMappings:
        - 0:3001
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "dev_app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "app-now-site"

# PRODUCTION environment configuration (TO BE DONE)
#
  - name: now-site-replicas-production
    type: replicas
    version:
      count: 3
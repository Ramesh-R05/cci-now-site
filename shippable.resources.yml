# This resources are only used for NOWTOLOVE

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:
  # Docker Image Options to run the container
  - name: now-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts: true
      logConfig:
        type: awslogs
        options:
          awslogs-group: 'app_ecs'
          awslogs-region: 'ap-southeast-2'
          awslogs-stream-prefix: 'app-now-site'

  # Seed image version MASTER Docker Image for the now-site
  - name: now-site-img-master
    type: image
    pointer:
      sourceName: '317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/now-site'
    seed:
      versionName: 'master.3614' # This can be changed for Roll back

  # Seed image version Feature BRANCH Docker Image for the now-site
  - name: now-site-img-branch
    type: image
    pointer:
      sourceName: '317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/now-site'
    seed:
      versionName: latest

  # NOW Github repo
  - name: now-site-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/now-site
      branch: master

  # NOW Github repo - branch for troubleshooting purpose
  # Enable the resource below and update a branch name. Please see the instruction in https://bauer-media.atlassian.net/wiki/x/GgBFIQ
  - name: now-site-repo-branch
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/now-site
      branch: fix/performance-test-for-nz-sites

  # Slack connection
  - name: now-slack-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#au-shippable'

  # Slack connection
  - name: now-qa-team-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#bxm_qa_notifications'

  # Slack connection
  - name: now-deployment-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#au-shippable'

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: now-site-version
    type: version
    seed:
      versionName: '1.180.0' # This can be changed for Roll back

  # REGION Parameter
  - name: now-site-params-nz-region
    type: params
    version:
      params:
        APP_REGION: 'nz'

  #Schedule Run of automation
  # This is using Shippable timezone
  # CRON is (30 21 * * *") this is 9:30pm every day refer to https://en.wikipedia.org/wiki/Cron
  # will run at 8:30am daylight saving or 7:30am standard time in Sydney
  - name: now-morning-trigger
    type: time
    seed:
      interval: '30 21 * * *'

  #"0 22 * * 1" is 10:00pm Monday which is Tuesday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: now-weekly-trigger
    type: time
    seed:
      interval: '0 22 * * 1'

  #"0 22 * * 3" is 10:00pm Wednesday which is Thursday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: nznow-weekly-trigger
    type: time
    seed:
      interval: '0 22 * * 3'

  #"30 22 * * 1,4" is 10:30pm Monday & Thursday which are Tuesday morning and Friday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: now-perf-live-trigger
    type: time
    seed:
      interval: '30 22 * * 1,4'

  #"30 22 * * 1" is 10:30pm Monday which is Tuesday morning 9:30am daylight saving or 8:30am standard time in Sydney
  - name: now-seo-live-trigger
    type: time
    seed:
      interval: '30 22 * * 1'

  ####################################
  # NON PROD environment configuration
  ####################################

  # AWS Non Prod Cluster
  - name: env-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName: 'app_ecs'
      region: 'ap-southeast-2'

  # AWS S3 bucket for storing test result files
  - name: test-result-s3-param
    type: params
    versionTemplate:
      params:
        AWS_S3_BUCKET: 's3://test-result-s3/'
        # AWS_SECRET_ACCESS_KEY AWS_ACCESS_KEY_ID
        secure: R/BaUgUpxd7VMVB+RQwSWoGVrvRSeLvpT4iHHDfiRuL8LDL5Y9V6ZaBy6+IJQtMb+VJolLZbrjOe5f1+KdwhLdPm/hwZpnemBSV+M5eWlLZ73aCipYevCQ9uHjA/STxMk06y0OfZPp52IrHjTCgWuMoGbKB9wHbAKlyxTbxY9D8drVPU5Cu60hMBv5Ryg7XU36WGLJVecQbiQ/LR5UB/Xve6Usr8kYWu1YA0OYdOvda85lTvzeilf67HDr1Iq7n2bXTD3ZBYPN5xaQ7ibp/IZEMm8mWu3Rq4G/7N7IwS2YU3O/DGrcfxDqfkJpkZjxyEDWsX0623PqlYS5xBpbjQ9Q==
        IMAGE: 317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/now-site

  # AWS SIT load Balancer - NOW AU - MASTER branch
  - name: au-now-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/now-site-au-sit/40d9881a0008f4b1'
      method: application

  # AWS SIT load Balancer - NOW NZ - MASTER branch
  - name: nz-now-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/now-site-nz-sit/46fe04e2d10ce191'
      method: application

  # AWS SIT:8080 load Balancer - NOW AU - feature BRANCH
  - name: now-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/now-site-au-branch-sit/e20cca1138db8557'
      method: application

  # AWS TEST load Balancer - Homes STUBBED - MASTER branch
  - name: now-site-alb-test
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/now-site-test/3640de7200782c72'
      method: application

  - name: now-site-test-env
    type: params
    versionTemplate:
      params:
        # EMAIL_HASH_SERVICE_SECRET_KEY APP_SERVICES_ACCESS_KEY REDIS_CONFIG_ENDPOINT_URL REDIS_CONFIG_ENDPOINT_PORT
        secure: s1wtWAoSv6P/9rJK8tZN+gST0QRpn1gALV+AJF4rnS28WWDz7ckzH+GEamdQwUILI4R5YqkMGZMWJ8NzPhnw8RFy+3FAQJfqVxcAcVxQaWbCFvWT5ZqdOr01Lcw1zkhnwP4nuNTTHnyAU/jCSdsXiU+tlekLdZvcDKCuKdArq5hUmA57mdO5AQVJtzX9l4q3C1Lu3l2m8l0PC75UT90rRj5quQ+v2GGeX6/z0QtNSI3+drejGdlhuAyUZZk8MVRuvdnsZ6f3e+SnIo30dcyta0ZudCKj7rWViNVLAbtb0SBg2buGxyhEp4KHDk4rXAvWKXoOp549O3IURoIUFmFchFfSRP0YsAa1F6bfkUUE2NyemF1fekYvHnTIRFtYJkFQQrW4oj3kxUzdSUVJCiF8cB/a6h2+kIitOnr9iwufeOW+UAeHPVCoE6+W4X8pub99L+BaYU8w6l9hiFN1v/16sG2+nEsNs8ZNdZ9Q3xM9EmNtRCkkghzNHOds/wB5KGf9CZ8nvUCfmkDoevclHwrcue9T2tdEoTHKKjtogEmpw9DhF0qvgykG79ysRBhSgWlXXoL0uxq5wMPoTswfYdxL+02ABPDKp+q5fDjqWRP25dpOJ6mvR3daRSlz43fSaZLlb3d5QB5aJ0kLCxehhg/GIY/G+Mc7mVH6IzM0fZK1yBw=

  # SIT AU Parameter
  - name: now-site-au-params-sit
    type: params
    version:
      params:
        NODE_ENV: 'production' #change this to dev when we are ready
        APP_ENV: 'sit'
        APM_KEY: 'c777240932e6282ffacc6a42ae6a0709426522bb'
        APP_DEBUG: true
        APP_REGION: 'au'
        # EMAIL_HASH_SERVICE_SECRET_KEY APP_SERVICES_ACCESS_KEY REDIS_CONFIG_ENDPOINT_URL REDIS_CONFIG_ENDPOINT_PORT
        secure: s1wtWAoSv6P/9rJK8tZN+gST0QRpn1gALV+AJF4rnS28WWDz7ckzH+GEamdQwUILI4R5YqkMGZMWJ8NzPhnw8RFy+3FAQJfqVxcAcVxQaWbCFvWT5ZqdOr01Lcw1zkhnwP4nuNTTHnyAU/jCSdsXiU+tlekLdZvcDKCuKdArq5hUmA57mdO5AQVJtzX9l4q3C1Lu3l2m8l0PC75UT90rRj5quQ+v2GGeX6/z0QtNSI3+drejGdlhuAyUZZk8MVRuvdnsZ6f3e+SnIo30dcyta0ZudCKj7rWViNVLAbtb0SBg2buGxyhEp4KHDk4rXAvWKXoOp549O3IURoIUFmFchFfSRP0YsAa1F6bfkUUE2NyemF1fekYvHnTIRFtYJkFQQrW4oj3kxUzdSUVJCiF8cB/a6h2+kIitOnr9iwufeOW+UAeHPVCoE6+W4X8pub99L+BaYU8w6l9hiFN1v/16sG2+nEsNs8ZNdZ9Q3xM9EmNtRCkkghzNHOds/wB5KGf9CZ8nvUCfmkDoevclHwrcue9T2tdEoTHKKjtogEmpw9DhF0qvgykG79ysRBhSgWlXXoL0uxq5wMPoTswfYdxL+02ABPDKp+q5fDjqWRP25dpOJ6mvR3daRSlz43fSaZLlb3d5QB5aJ0kLCxehhg/GIY/G+Mc7mVH6IzM0fZK1yBw=

  # SIT NZ Parameter
  - name: now-site-nz-params-sit
    type: params
    version:
      params:
        NODE_ENV: 'production' #change this to dev when we are ready
        APP_ENV: 'sit'
        APM_KEY: 'c777240932e6282ffacc6a42ae6a0709426522bb'
        APP_DEBUG: true
        APP_REGION: 'nz'
        # EMAIL_HASH_SERVICE_SECRET_KEY APP_SERVICES_ACCESS_KEY REDIS_CONFIG_ENDPOINT_URL REDIS_CONFIG_ENDPOINT_PORT
        secure: s1wtWAoSv6P/9rJK8tZN+gST0QRpn1gALV+AJF4rnS28WWDz7ckzH+GEamdQwUILI4R5YqkMGZMWJ8NzPhnw8RFy+3FAQJfqVxcAcVxQaWbCFvWT5ZqdOr01Lcw1zkhnwP4nuNTTHnyAU/jCSdsXiU+tlekLdZvcDKCuKdArq5hUmA57mdO5AQVJtzX9l4q3C1Lu3l2m8l0PC75UT90rRj5quQ+v2GGeX6/z0QtNSI3+drejGdlhuAyUZZk8MVRuvdnsZ6f3e+SnIo30dcyta0ZudCKj7rWViNVLAbtb0SBg2buGxyhEp4KHDk4rXAvWKXoOp549O3IURoIUFmFchFfSRP0YsAa1F6bfkUUE2NyemF1fekYvHnTIRFtYJkFQQrW4oj3kxUzdSUVJCiF8cB/a6h2+kIitOnr9iwufeOW+UAeHPVCoE6+W4X8pub99L+BaYU8w6l9hiFN1v/16sG2+nEsNs8ZNdZ9Q3xM9EmNtRCkkghzNHOds/wB5KGf9CZ8nvUCfmkDoevclHwrcue9T2tdEoTHKKjtogEmpw9DhF0qvgykG79ysRBhSgWlXXoL0uxq5wMPoTswfYdxL+02ABPDKp+q5fDjqWRP25dpOJ6mvR3daRSlz43fSaZLlb3d5QB5aJ0kLCxehhg/GIY/G+Mc7mVH6IzM0fZK1yBw=

  # TEST Parameter
  - name: now-site-params-test
    type: params
    version:
      params:
        NODE_ENV: 'production'
        APP_ENV: 'test'
        APP_STUBBED: true
        APP_DEBUG: true
        APP_REGION: 'au'

  ####################################
  # PROD environment configuration
  # DO NOT DELETE
  # DO NOT DELETE
  # DO NOT DELETE
  ####################################

  # AWS Prod Cluster
  - name: env-prod-ecs
    type: cluster
    integration: digital-prod-AWS
    pointer:
      sourceName: 'app_ecs'
      region: 'ap-southeast-2'

  # AWS PROD load Balancer - AU NOW PROD - MASTER branch
  - name: au-now-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/now-site-prod/d470fcdb27032289'
      method: application

  # AWS PROD load Balancer - NZ NOW PROD - MASTER branch
  - name: nz-now-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/now-site-nz-prod/954d2eeb427e106a'
      method: application

  # PROD parameters
  - name: now-site-params-prod
    type: params
    version:
      params:
        NODE_ENV: 'production'
        APP_ENV: 'prod'
        APM_KEY: 'c777240932e6282ffacc6a42ae6a0709426522bb'
        # EMAIL_HASH_SERVICE_SECRET_KEY APP_SERVICES_ACCESS_KEY REDIS_CONFIG_ENDPOINT_URL REDIS_CONFIG_ENDPOINT_PORT
        secure: epLIG3XxlwZvGIn3sN207YO3eGJmb+dX0qGTREgjHZKTjjUZbuk3NNE98OctcBsaolRpJoRl+JK+6NFhDLNKPQQjSfnB6BHP4ShBrKpPg1h30SDDtMfzRlx7owbJ1AFdyHWrGewxjXcZbTyPyXvDmrBggNR7oM6u1NhC4i67eDc1+f67JRzG5gR9OQZfVyRBsZyZI7MCaqPoa7+aGo7sWAIPUa3QsViBv5EbwmVsP5ox4IKRIgpTAhMD4AGHp3phx7kqzwfsMdzGFe7hQphVMeUjEMK9l+HO2IsNVvb05UkxkaZv/0tIpit3Wblzo73YulP8VSl1yWmmSaOccStSFpNz0LROU93Id6tvSCk4yAx45W906OQn5qEWG5c2Ci/QyYiPQnB2GPzC1fBzLRK3w2rIueBqj65nraIUTvLCc5s3QoJNTcLMZXEh5auzM2AzeU2p2rZSuOqZCFO60S1Lg6hlpW4LitqKi8HVSK09RN7eF+JCNqDuE8NsAXjheij6dq0HeaP/nav2kRpkgbzKPDz1eVPz6W0PB2LLjEQteNsWDnY4Pv3ZARID7YWtxuoDnvs//8WzpEzEfTlDe2slItXYfGl64c+vLJE+yhnZreo1MyUNnUTO/NXFTxutKRzF4teztys7Qnh89kf1RZmE3x9kFry1qbkNpd+PVsYbCbs=
